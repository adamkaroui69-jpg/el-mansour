<UserControl x:Class="ElMansourSyndicManager.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             xmlns:viewModels="clr-namespace:ElMansourSyndicManager.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200"
             d:DataContext="{d:DesignInstance viewModels:DashboardViewModel}">
    
    <ScrollViewer VerticalScrollBarVisibility="Auto">
        <StackPanel Margin="24">
            <!-- Header -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,32">
                <TextBlock Text="Hey " FontSize="28" FontWeight="Bold" Foreground="{DynamicResource MaterialDesignBody}"/>
                <TextBlock Text="{Binding UserName}" FontSize="28" FontWeight="Bold" Foreground="{DynamicResource MaterialDesignBody}"/>
                <TextBlock Text="! ðŸ‘‹" FontSize="28" FontWeight="Bold" Foreground="{DynamicResource MaterialDesignBody}"/>
            </StackPanel>

            <!-- KPI Cards -->
            <UniformGrid Columns="4" Margin="0,0,0,32">
                <!-- Card 1: Total DÃ» -->
                <materialDesign:Card Margin="0,0,12,0" UniformCornerRadius="16" Padding="20" Background="{DynamicResource MaterialDesignPaper}" materialDesign:ShadowAssist.ShadowDepth="Depth1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="0" Width="56" Height="56" CornerRadius="16" Background="#EDE7F6">
                            <materialDesign:PackIcon Kind="CashClock" Width="28" Height="28" Foreground="#673AB7" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <StackPanel Grid.Column="1" Margin="16,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Total DÃ»" FontSize="14" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                            <TextBlock Text="{Binding TotalDue, StringFormat='{}{0:N0} TND'}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,4,0,0"/>
                        </StackPanel>
                    </Grid>
                </materialDesign:Card>
                
                <!-- Card 2: Maisons ImpayÃ©es -->
                <materialDesign:Card Margin="12,0,12,0" UniformCornerRadius="16" Padding="20" Background="{DynamicResource MaterialDesignPaper}" materialDesign:ShadowAssist.ShadowDepth="Depth1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="0" Width="56" Height="56" CornerRadius="16" Background="#E3F2FD">
                            <materialDesign:PackIcon Kind="HomeAlert" Width="28" Height="28" Foreground="#2196F3" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <StackPanel Grid.Column="1" Margin="16,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Maisons ImpayÃ©es" FontSize="14" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                            <TextBlock Text="{Binding UnpaidHousesCount}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,4,0,0"/>
                        </StackPanel>
                    </Grid>
                </materialDesign:Card>

                <!-- Card 3: Total CollectÃ© -->
                <materialDesign:Card Margin="12,0,12,0" UniformCornerRadius="16" Padding="20" Background="{DynamicResource MaterialDesignPaper}" materialDesign:ShadowAssist.ShadowDepth="Depth1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="0" Width="56" Height="56" CornerRadius="16" Background="#FFF3E0">
                            <materialDesign:PackIcon Kind="CashCheck" Width="28" Height="28" Foreground="#FF9800" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <StackPanel Grid.Column="1" Margin="16,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Total CollectÃ©" FontSize="14" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                            <TextBlock Text="{Binding TotalCollected, StringFormat='{}{0:N0} TND'}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,4,0,0"/>
                        </StackPanel>
                    </Grid>
                </materialDesign:Card>

                <!-- Card 4: Total DÃ©pensÃ© -->
                <materialDesign:Card Margin="12,0,0,0" UniformCornerRadius="16" Padding="20" Background="{DynamicResource MaterialDesignPaper}" materialDesign:ShadowAssist.ShadowDepth="Depth1">
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="Auto"/>
                            <ColumnDefinition Width="*"/>
                        </Grid.ColumnDefinitions>
                        <Border Grid.Column="0" Width="56" Height="56" CornerRadius="16" Background="#E8F5E9">
                            <materialDesign:PackIcon Kind="CashRemove" Width="28" Height="28" Foreground="#4CAF50" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                        </Border>
                        <StackPanel Grid.Column="1" Margin="16,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="Total DÃ©pensÃ©" FontSize="14" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                            <TextBlock Text="{Binding TotalSpent, StringFormat='{}{0:N0} TND'}" FontSize="20" FontWeight="Bold" Foreground="{DynamicResource MaterialDesignBody}" Margin="0,4,0,0"/>
                        </StackPanel>
                    </Grid>
                </materialDesign:Card>
            </UniformGrid>

            <!-- Tables Section -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Left Table: Recent Payments -->
                <materialDesign:Card Grid.Column="0" Margin="0,0,12,0" UniformCornerRadius="16" Padding="0" Background="{DynamicResource MaterialDesignPaper}" materialDesign:ShadowAssist.ShadowDepth="Depth1">
                    <StackPanel>
                        <TextBlock Text="Derniers Paiements" FontSize="18" FontWeight="Bold" Margin="24,24,24,16" Foreground="{DynamicResource MaterialDesignBody}"/>
                        <DataGrid ItemsSource="{Binding RecentPayments}" AutoGenerateColumns="False" IsReadOnly="True" 
                                  HeadersVisibility="Column" GridLinesVisibility="Horizontal" Background="Transparent" BorderThickness="0"
                                  HorizontalGridLinesBrush="{DynamicResource MaterialDesignDivider}"
                                  materialDesign:DataGridAssist.CellPadding="16 12 12 12" VerticalScrollBarVisibility="Auto" MaxHeight="400">
                            <DataGrid.Resources>
                                <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBodyLight}"/>
                                    <Setter Property="FontSize" Value="13"/>
                                    <Setter Property="Padding" Value="16,8,8,8"/>
                                </Style>
                            </DataGrid.Resources>
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="Maison" Width="*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Border Width="36" Height="36" CornerRadius="18" Background="#F5F5F5" Margin="0,0,12,0">
                                                    <TextBlock Text="{Binding HouseCode}" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="11" FontWeight="Bold" Foreground="#616161"/>
                                                </Border>
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding HouseCode}" FontWeight="SemiBold" FontSize="14"/>
                                                    <TextBlock Text="RÃ©sident" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Mois" Binding="{Binding Month}" Width="Auto" ElementStyle="{StaticResource MaterialDesignDataGridTextColumnStyle}"/>
                                <DataGridTextColumn Header="Montant" Binding="{Binding Amount, StringFormat='{}{0:N0} TND'}" Width="Auto" ElementStyle="{StaticResource MaterialDesignDataGridTextColumnStyle}"/>
                                <DataGridTemplateColumn Header="Statut" Width="Auto">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Background="#E8F5E9" CornerRadius="6" Padding="10,4">
                                                <TextBlock Text="PayÃ©" Foreground="#2E7D32" FontSize="12" FontWeight="SemiBold"/>
                                            </Border>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </materialDesign:Card>

                <!-- Right Table: Unpaid Houses -->
                <materialDesign:Card Grid.Column="1" Margin="12,0,0,0" UniformCornerRadius="16" Padding="0" Background="{DynamicResource MaterialDesignPaper}" materialDesign:ShadowAssist.ShadowDepth="Depth1">
                    <StackPanel>
                        <TextBlock Text="Maisons ImpayÃ©es" FontSize="18" FontWeight="Bold" Margin="24,24,24,16" Foreground="{DynamicResource MaterialDesignBody}"/>
                        <DataGrid ItemsSource="{Binding UnpaidHouses}" AutoGenerateColumns="False" IsReadOnly="True" 
                                  HeadersVisibility="Column" GridLinesVisibility="Horizontal" Background="Transparent" BorderThickness="0"
                                  HorizontalGridLinesBrush="{DynamicResource MaterialDesignDivider}"
                                  materialDesign:DataGridAssist.CellPadding="16 12 12 12" VerticalScrollBarVisibility="Auto" MaxHeight="400">
                            <DataGrid.Resources>
                                <Style TargetType="DataGridColumnHeader" BasedOn="{StaticResource MaterialDesignDataGridColumnHeader}">
                                    <Setter Property="FontWeight" Value="SemiBold"/>
                                    <Setter Property="Foreground" Value="{DynamicResource MaterialDesignBodyLight}"/>
                                    <Setter Property="FontSize" Value="13"/>
                                    <Setter Property="Padding" Value="16,8,8,8"/>
                                </Style>
                            </DataGrid.Resources>
                            <DataGrid.Columns>
                                <DataGridTemplateColumn Header="Maison" Width="*">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <StackPanel Orientation="Horizontal">
                                                <Border Width="36" Height="36" CornerRadius="18" Background="#FFEBEE" Margin="0,0,12,0">
                                                    <TextBlock Text="{Binding HouseCode}" VerticalAlignment="Center" HorizontalAlignment="Center" FontSize="11" FontWeight="Bold" Foreground="#D32F2F"/>
                                                </Border>
                                                <StackPanel VerticalAlignment="Center">
                                                    <TextBlock Text="{Binding HouseCode}" FontWeight="SemiBold" FontSize="14"/>
                                                    <TextBlock Text="{Binding OwnerName}" FontSize="12" Foreground="{DynamicResource MaterialDesignBodyLight}"/>
                                                </StackPanel>
                                            </StackPanel>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                                <DataGridTextColumn Header="Montant" Binding="{Binding MonthlyAmount, StringFormat='{}{0:N0} TND'}" Width="Auto" ElementStyle="{StaticResource MaterialDesignDataGridTextColumnStyle}"/>
                                <DataGridTemplateColumn Header="PrioritÃ©" Width="Auto">
                                    <DataGridTemplateColumn.CellTemplate>
                                        <DataTemplate>
                                            <Border Background="#FFEBEE" CornerRadius="6" Padding="10,4">
                                                <TextBlock Text="Haute" Foreground="#C62828" FontSize="12" FontWeight="SemiBold"/>
                                            </Border>
                                        </DataTemplate>
                                    </DataGridTemplateColumn.CellTemplate>
                                </DataGridTemplateColumn>
                            </DataGrid.Columns>
                        </DataGrid>
                    </StackPanel>
                </materialDesign:Card>
            </Grid>
        </StackPanel>
    </ScrollViewer>
</UserControl>
