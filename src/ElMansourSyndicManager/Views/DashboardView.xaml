<UserControl x:Class="ElMansourSyndicManager.Views.DashboardView"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
             xmlns:lvc="clr-namespace:LiveChartsCore.SkiaSharpView.WPF;assembly=LiveChartsCore.SkiaSharpView.WPF"
             xmlns:viewModels="clr-namespace:ElMansourSyndicManager.ViewModels"
             mc:Ignorable="d" 
             d:DesignHeight="800" d:DesignWidth="1200"
             d:DataContext="{d:DesignInstance viewModels:DashboardViewModel}">
    
    <ScrollViewer VerticalScrollBarVisibility="Auto" Padding="0,0,10,0">
        <StackPanel Margin="0">
            <!-- Header de Bienvenue -->
            <StackPanel Orientation="Horizontal" Margin="0,0,0,40">
                <TextBlock Text="Bonjour, " FontSize="32" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}"/>
                <TextBlock Text="{Binding UserName}" FontSize="32" FontWeight="Bold" Foreground="{StaticResource PrimaryBrush}"/>
                <TextBlock Text=" ðŸ‘‹" FontSize="32"/>
            </StackPanel>

            <!-- KPI Cards (Glassmorphism) -->
            <UniformGrid Columns="4" Margin="0,0,0,40">
                <!-- Card 1: Total DÃ» -->
                <Border Style="{StaticResource GlassCard}" Margin="0,0,20,0" Padding="24">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
                            <Border Width="48" Height="48" CornerRadius="12" Background="#208B5CF6">
                                <materialDesign:PackIcon Kind="CashClock" Width="24" Height="24" Foreground="#8B5CF6" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="Total DÃ»" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="16,0,0,0"/>
                        </StackPanel>
                        
                        <TextBlock Grid.Row="1" Text="{Binding TotalDue, StringFormat='{}{0:N0} TND'}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,20,0,0"/>
                    </Grid>
                </Border>
                
                <!-- Card 2: Maisons ImpayÃ©es -->
                <Border Style="{StaticResource GlassCard}" Margin="0,0,20,0" Padding="24">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
                            <Border Width="48" Height="48" CornerRadius="12" Background="#20EF4444">
                                <materialDesign:PackIcon Kind="HomeAlert" Width="24" Height="24" Foreground="#EF4444" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="ImpayÃ©s" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="16,0,0,0"/>
                        </StackPanel>
                        
                        <TextBlock Grid.Row="1" Text="{Binding UnpaidHousesCount}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,20,0,0"/>
                    </Grid>
                </Border>

                <!-- Card 3: Total CollectÃ© -->
                <Border Style="{StaticResource GlassCard}" Margin="0,0,20,0" Padding="24">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
                            <Border Width="48" Height="48" CornerRadius="12" Background="#20F59E0B">
                                <materialDesign:PackIcon Kind="CashCheck" Width="24" Height="24" Foreground="#F59E0B" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="CollectÃ©" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="16,0,0,0"/>
                        </StackPanel>
                        
                        <TextBlock Grid.Row="1" Text="{Binding TotalCollected, StringFormat='{}{0:N0} TND'}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,20,0,0"/>
                    </Grid>
                </Border>

                <!-- Card 4: Total DÃ©pensÃ© -->
                <Border Style="{StaticResource GlassCard}" Margin="0,0,0,0" Padding="24">
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>
                        
                        <StackPanel Orientation="Horizontal" VerticalAlignment="Top">
                            <Border Width="48" Height="48" CornerRadius="12" Background="#2010B981">
                                <materialDesign:PackIcon Kind="CashRemove" Width="24" Height="24" Foreground="#10B981" VerticalAlignment="Center" HorizontalAlignment="Center"/>
                            </Border>
                            <TextBlock Text="DÃ©pensÃ©" FontSize="14" Foreground="{StaticResource TextSecondaryBrush}" VerticalAlignment="Center" Margin="16,0,0,0"/>
                        </StackPanel>
                        
                        <TextBlock Grid.Row="1" Text="{Binding TotalSpent, StringFormat='{}{0:N0} TND'}" FontSize="28" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="0,20,0,0"/>
                    </Grid>
                </Border>
            </UniformGrid>

            <!-- Section des Tableaux et Graphiques -->
            <Grid>
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="2*"/>
                    <ColumnDefinition Width="20"/>
                    <ColumnDefinition Width="1*"/>
                </Grid.ColumnDefinitions>

                <!-- Colonne Gauche: Maisons ImpayÃ©es -->
                <Border Grid.Column="0" Style="{StaticResource GlassCard}" Padding="24">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <materialDesign:PackIcon Kind="HomeAlert" Width="24" Height="24" Foreground="#EF4444" VerticalAlignment="Center"/>
                            <TextBlock Text="Maisons en Retard" FontSize="18" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="12,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <DataGrid ItemsSource="{Binding UnpaidHouses}"
                                  AutoGenerateColumns="False"
                                  CanUserAddRows="False"
                                  CanUserDeleteRows="False"
                                  IsReadOnly="True"
                                  HeadersVisibility="Column"
                                  GridLinesVisibility="None"
                                  Background="Transparent"
                                  RowBackground="#10FFFFFF"
                                  AlternatingRowBackground="#05FFFFFF"
                                  BorderThickness="0"
                                  MaxHeight="300">
                            <DataGrid.Columns>
                                <DataGridTextColumn Header="Maison" Binding="{Binding HouseCode}" Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                            <Setter Property="FontWeight" Value="SemiBold"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="PropriÃ©taire" Binding="{Binding OwnerName}" Width="2*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                                <DataGridTextColumn Header="Montant" Binding="{Binding MonthlyAmount, StringFormat='{}{0:N0} TND'}" Width="*">
                                    <DataGridTextColumn.ElementStyle>
                                        <Style TargetType="TextBlock">
                                            <Setter Property="Foreground" Value="#EF4444"/>
                                            <Setter Property="FontWeight" Value="Bold"/>
                                            <Setter Property="HorizontalAlignment" Value="Right"/>
                                        </Style>
                                    </DataGridTextColumn.ElementStyle>
                                </DataGridTextColumn>
                            </DataGrid.Columns>
                            <DataGrid.ColumnHeaderStyle>
                                <Style TargetType="DataGridColumnHeader">
                                    <Setter Property="Background" Value="Transparent"/>
                                    <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                    <Setter Property="FontWeight" Value="Bold"/>
                                    <Setter Property="FontSize" Value="12"/>
                                    <Setter Property="Padding" Value="8"/>
                                    <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                    <Setter Property="BorderBrush" Value="#20FFFFFF"/>
                                </Style>
                            </DataGrid.ColumnHeaderStyle>
                        </DataGrid>
                    </StackPanel>
                </Border>

                <!-- Colonne Droite: DÃ©penses du Mois -->
                <Border Grid.Column="2" Style="{StaticResource GlassCard}" Padding="24">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                            <materialDesign:PackIcon Kind="CashRemove" Width="24" Height="24" Foreground="#10B981" VerticalAlignment="Center"/>
                            <TextBlock Text="DÃ©penses RÃ©centes" FontSize="18" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="12,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>

                        <ItemsControl ItemsSource="{Binding RecentExpenses}">
                            <ItemsControl.ItemTemplate>
                                <DataTemplate>
                                    <Border Background="#10FFFFFF" CornerRadius="8" Padding="12" Margin="0,0,0,8">
                                        <Grid>
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto"/>
                                                <RowDefinition Height="Auto"/>
                                            </Grid.RowDefinitions>
                                            
                                            <TextBlock Grid.Row="0" Text="{Binding Description}" FontWeight="SemiBold" Foreground="{StaticResource TextPrimaryBrush}" TextTrimming="CharacterEllipsis"/>
                                            <StackPanel Grid.Row="1" Orientation="Horizontal" Margin="0,4,0,0">
                                                <TextBlock Text="{Binding ExpenseDate, StringFormat='dd/MM/yyyy'}" FontSize="11" Foreground="{StaticResource TextSecondaryBrush}"/>
                                                <TextBlock Text=" â€¢ " FontSize="11" Foreground="{StaticResource TextSecondaryBrush}" Margin="4,0"/>
                                                <TextBlock Text="{Binding Amount, StringFormat='{}{0:N0} TND'}" FontSize="11" FontWeight="Bold" Foreground="#10B981"/>
                                            </StackPanel>
                                        </Grid>
                                    </Border>
                                </DataTemplate>
                            </ItemsControl.ItemTemplate>
                        </ItemsControl>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- Section Paiements RÃ©cents -->
            <Border Style="{StaticResource GlassCard}" Padding="24" Margin="0,40,0,0">
                <StackPanel>
                    <StackPanel Orientation="Horizontal" Margin="0,0,0,20">
                        <materialDesign:PackIcon Kind="CashCheck" Width="24" Height="24" Foreground="#F59E0B" VerticalAlignment="Center"/>
                        <TextBlock Text="Paiements de ce Mois" FontSize="18" FontWeight="Bold" Foreground="{StaticResource TextPrimaryBrush}" Margin="12,0,0,0" VerticalAlignment="Center"/>
                    </StackPanel>

                    <DataGrid ItemsSource="{Binding RecentPayments}"
                              AutoGenerateColumns="False"
                              CanUserAddRows="False"
                              CanUserDeleteRows="False"
                              IsReadOnly="True"
                              HeadersVisibility="Column"
                              GridLinesVisibility="None"
                              Background="Transparent"
                              RowBackground="#10FFFFFF"
                              AlternatingRowBackground="#05FFFFFF"
                              BorderThickness="0"
                              MaxHeight="250">
                        <DataGrid.Columns>
                            <DataGridTextColumn Header="Maison" Binding="{Binding HouseCode}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="{StaticResource TextPrimaryBrush}"/>
                                        <Setter Property="FontWeight" Value="SemiBold"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Date" Binding="{Binding PaymentDate, StringFormat='dd/MM/yyyy'}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Mois" Binding="{Binding Month}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                            <DataGridTextColumn Header="Montant" Binding="{Binding Amount, StringFormat='{}{0:N0} TND'}" Width="*">
                                <DataGridTextColumn.ElementStyle>
                                    <Style TargetType="TextBlock">
                                        <Setter Property="Foreground" Value="#10B981"/>
                                        <Setter Property="FontWeight" Value="Bold"/>
                                        <Setter Property="HorizontalAlignment" Value="Right"/>
                                    </Style>
                                </DataGridTextColumn.ElementStyle>
                            </DataGridTextColumn>
                        </DataGrid.Columns>
                        <DataGrid.ColumnHeaderStyle>
                            <Style TargetType="DataGridColumnHeader">
                                <Setter Property="Background" Value="Transparent"/>
                                <Setter Property="Foreground" Value="{StaticResource TextSecondaryBrush}"/>
                                <Setter Property="FontWeight" Value="Bold"/>
                                <Setter Property="FontSize" Value="12"/>
                                <Setter Property="Padding" Value="8"/>
                                <Setter Property="BorderThickness" Value="0,0,0,1"/>
                                <Setter Property="BorderBrush" Value="#20FFFFFF"/>
                            </Style>
                        </DataGrid.ColumnHeaderStyle>
                    </DataGrid>
                </StackPanel>
            </Border>

        </StackPanel>
    </ScrollViewer>
</UserControl>
